<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>博客后台 | Decap CMS</title>
    <!-- 使用更稳定的 3.3.0 版本 -->
    <script src="https://cdn.jsdelivr.net/npm/decap-cms@3.3.0/dist/decap-cms.js"></script>
    <style>
        /* 极简样式，只确保根容器可见 */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: sans-serif;
            background: #f5f5f5;
        }
        #loading {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 15px;
            margin: 20px;
            border-radius: 5px;
            display: none;
        }
        /* 确保CMS根容器占据全屏 */
        #nc-root {
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <!-- 第一阶段：简单的加载提示 -->
    <div id="loading">
        <h2>正在加载内容管理系统...</h2>
        <p>如果长时间停留在此页面，请尝试刷新。</p>
    </div>

    <!-- 第二阶段：错误信息（默认隐藏） -->
    <div id="error" class="error"></div>

    <!-- 第三阶段：Decap CMS 将完全控制并替换这个容器 -->
    <div id="nc-root"></div>

    <script>
        // 定义显示错误函数
        function showError(msg) {
            console.error('CMS Error:', msg);
            document.getElementById('loading').style.display = 'none';
            var errorEl = document.getElementById('error');
            errorEl.innerHTML = '<strong>错误：</strong>' + msg;
            errorEl.style.display = 'block';
        }

        // 主初始化函数
        function initCMS() {
            // 1. 检查库是否加载
            if (typeof CMS === 'undefined') {
                showError('CMS 核心库未能加载。请检查网络连接或稍后重试。');
                return;
            }

            // 2. 尝试初始化 - 使用 try-catch 捕获所有可能错误
            try {
                console.log('开始初始化 Decap CMS...');
                // 关键：初始化时不做任何额外操作，让CMS完全控制
                CMS.init();
                console.log('CMS.init() 调用成功，界面应开始渲染。');
                // 初始化调用成功后，加载提示会被CMS自动生成的界面覆盖
            } catch (err) {
                // 捕获并显示初始化过程中抛出的任何异常
                showError('初始化失败: ' + err.message);
            }
        }

        // 3. 启动策略：库加载后立即初始化（最常见的成功路径）
        if (typeof CMS !== 'undefined') {
            // 如果库已经加载（可能缓存了），立即初始化
            initCMS();
        } else {
            // 否则，监听库的加载事件
            window.addEventListener('load', initCMS);
        }

        // 4. 安全后备：10秒后如果页面还是加载状态，提示用户
        setTimeout(function() {
            var loadingEl = document.getElementById('loading');
            if (loadingEl && loadingEl.style.display !== 'none') {
                loadingEl.innerHTML = '<p>加载时间较长，正在重试...</p>';
                // 可以尝试重新加载库或提供手动刷新提示
            }
        }, 10000);
    </script>
</body>
</html>