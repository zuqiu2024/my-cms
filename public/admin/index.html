<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åšå®¢ç®¡ç†åå° - è‡ªæ£€æ¨¡å¼</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: sans-serif; background: #f5f5f5; display: flex; justify-content: center; align-items: center; }
        #app { background: white; padding: 3rem; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 500px; text-align: center; }
        .status { margin: 20px 0; padding: 15px; border-radius: 8px; }
        .loading { background: #e3f2fd; color: #1565c0; }
        .success { background: #e8f5e9; color: #2e7d32; display: none; }
        .error { background: #ffebee; color: #c62828; display: none; }
        .detail { font-size: 0.9em; color: #666; margin-top: 10px; text-align: left; background: #fafafa; padding: 10px; border-radius: 5px; font-family: monospace; }
        button { padding: 10px 20px; margin: 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
        #retryBtn { background: #2196f3; color: white; }
        #diagnoseBtn { background: #ff9800; color: white; }
    </style>
</head>
<body>
    <div id="app">
        <h2>ğŸ”§ Decap CMS è‡ªæ£€æ¨¡å¼</h2>
        <div id="statusLoad" class="status loading">ğŸ”„ ç¬¬1æ­¥ï¼šæ­£åœ¨åŠ è½½ Decap CMS åº“...</div>
        <div id="statusInit" class="status loading">â³ ç¬¬2æ­¥ï¼šå‡†å¤‡åˆå§‹åŒ–...</div>
        <div id="statusSuccess" class="status success">âœ… åˆå§‹åŒ–æˆåŠŸï¼CMSç•Œé¢åº”å·²åŠ è½½ã€‚</div>
        <div id="statusError" class="status error">âŒ åŠ è½½å¤±è´¥ã€‚</div>

        <div id="errorDetail" class="detail"></div>

        <div id="actionArea">
            <button id="retryBtn" onclick="window.location.reload(true)">ğŸ”„ å¼ºåˆ¶åˆ·æ–°é‡è¯•</button>
            <button id="diagnoseBtn" onclick="runDiagnosis()">ğŸ” æ˜¾ç¤ºè¯Šæ–­ä¿¡æ¯</button>
        </div>
        <p style="margin-top: 20px; font-size: 0.9em; color: #888;">
            æç¤ºï¼šå¦‚æœæŒç»­å¤±è´¥ï¼Œè¯·æŒ‰F12æ‰“å¼€â€œæ§åˆ¶å°â€æŸ¥çœ‹å…·ä½“é”™è¯¯ã€‚
        </p>
    </div>

    <!-- ä½¿ç”¨æ˜ç¡®ç‰ˆæœ¬çš„åº“ -->
    <script src="https://unpkg.com/decap-cms@2.15.0/dist/decap-cms.js"></script>

    <script>
        // è¯Šæ–­å‡½æ•°
        function runDiagnosis() {
            const detail = document.getElementById('errorDetail');
            let html = `<strong>è¯Šæ–­æŠ¥å‘Šï¼š</strong><br>`;
            html += `â€¢ CMS åº“å·²å®šä¹‰: ${typeof CMS !== 'undefined' ? 'æ˜¯' : 'å¦'}<br>`;
            html += `â€¢ å½“å‰URL: ${window.location.href}<br>`;
            html += `â€¢ é¡µé¢è·¯å¾„: ${window.location.pathname}<br>`;
            if (typeof CMS === 'undefined') {
                html += `â€¢ å»ºè®®: Decap CMSæ ¸å¿ƒè„šæœ¬æœªåŠ è½½ã€‚å¯èƒ½åŸå› ï¼š<br>&nbsp;&nbsp;- ç½‘ç»œé˜»æ­¢äº† unpkg.com<br>&nbsp;&nbsp;- æµè§ˆå™¨æ‰©å±•æ‹¦æˆªäº†è„šæœ¬<br>&nbsp;&nbsp;- è¯·å°è¯•ä½¿ç”¨VPNæˆ–æ£€æŸ¥å¼€å‘è€…å·¥å…·â€œç½‘ç»œâ€é¢æ¿ã€‚`;
            }
            detail.innerHTML = html;
            detail.style.display = 'block';
        }

        // ä¸»åˆå§‹åŒ–æµç¨‹
        function initApp() {
            const statusLoad = document.getElementById('statusLoad');
            const statusInit = document.getElementById('statusInit');
            const statusError = document.getElementById('statusError');

            // æ­¥éª¤1ï¼šæ£€æµ‹åº“
            if (typeof CMS === 'undefined') {
                statusLoad.className = 'status error';
                statusLoad.innerHTML = 'âŒ ç¬¬1æ­¥å¤±è´¥ï¼šæ— æ³•åŠ è½½Decap CMSåº“ã€‚';
                statusError.style.display = 'block';
                runDiagnosis(); // è‡ªåŠ¨è¯Šæ–­
                return;
            }
            statusLoad.className = 'status success';
            statusLoad.innerHTML = 'âœ… ç¬¬1æ­¥å®Œæˆï¼šCMSåº“å·²åŠ è½½ã€‚';
            console.log('Decap CMS ç‰ˆæœ¬:', CMS.version);

            // æ­¥éª¤2ï¼šåˆå§‹åŒ–é…ç½®
            setTimeout(() => {
                try {
                    // å†…è”é…ç½® - è¿™æ˜¯å…³é”®ï¼
                    const config = {
                        backend: {
                            name: 'github',
                            repo: 'zuqiu2024/zxx',
                            branch: 'master',
                            base_url: 'https://zhanxx1.de5.net',
                            auth_scope: 'repo',
                            api_root: 'https://api.github.com'
                        },
                        media_folder: "public/images",
                        public_folder: "/images",
                        collections: [{
                            name: "posts",
                            label: "æ–‡ç« ",
                            folder: "src/content/posts",
                            create: true,
                            slug: "{{slug}}",
                            fields: [
                                { label: "æ ‡é¢˜", name: "title", widget: "string" },
                                { label: "å‘å¸ƒæ—¥æœŸ", name: "published", widget: "datetime", format: "YYYY-MM-DD" },
                                { label: "æè¿°", name: "description", widget: "text" },
                                { label: "æ ‡ç­¾", name: "tags", widget: "list" },
                                { label: "å°é¢å›¾ç‰‡", name: "image", widget: "string" },
                                { label: "ä½œè€…", name: "author", widget: "string", default: "å±•" },
                                { label: "æ­£æ–‡", name: "body", widget: "markdown" }
                            ]
                        }]
                    };

                    CMS.init({ config });
                    statusInit.className = 'status success';
                    statusInit.innerHTML = 'âœ… ç¬¬2æ­¥å®Œæˆï¼šCMSå·²åˆå§‹åŒ–ã€‚';
                    document.getElementById('statusSuccess').style.display = 'block';
                    console.log('CMS åˆå§‹åŒ–è°ƒç”¨å®Œæˆã€‚');

                } catch (initError) {
                    statusInit.className = 'status error';
                    statusInit.innerHTML = 'âŒ ç¬¬2æ­¥å¤±è´¥ï¼šåˆå§‹åŒ–æ—¶å‡ºé”™ã€‚';
                    statusError.style.display = 'block';
                    document.getElementById('errorDetail').innerHTML = `åˆå§‹åŒ–é”™è¯¯: ${initError.message}<br>è¯·æ£€æŸ¥æ§åˆ¶å°è·å–è¯¦æƒ…ã€‚`;
                    document.getElementById('errorDetail').style.display = 'block';
                    console.error('åˆå§‹åŒ–é”™è¯¯:', initError);
                }
            }, 500); // ç»™åº“ä¸€ç‚¹å‡†å¤‡æ—¶é—´
        }

        // å¯åŠ¨ï¼šå…ˆç»™åº“5ç§’åŠ è½½æ—¶é—´ï¼Œè¶…æ—¶åˆ™æŠ¥é”™
        document.addEventListener('DOMContentLoaded', function() {
            let loadTimeout = setTimeout(() => {
                if (typeof CMS === 'undefined') {
                    document.getElementById('statusLoad').className = 'status error';
                    document.getElementById('statusLoad').innerHTML = 'âŒ åŠ è½½è¶…æ—¶ï¼šDecap CMSåº“æœªåœ¨5ç§’å†…åŠ è½½ã€‚';
                    document.getElementById('statusError').style.display = 'block';
                    runDiagnosis();
                }
            }, 5000);

            // å¦‚æœåº“æå‰åŠ è½½å¥½ï¼Œç«‹å³åˆå§‹åŒ–
            if (typeof CMS !== 'undefined') {
                clearTimeout(loadTimeout);
                initApp();
            } else {
                // ç›‘å¬åº“çš„åŠ è½½
                const checkLib = setInterval(() => {
                    if (typeof CMS !== 'undefined') {
                        clearInterval(checkLib);
                        clearTimeout(loadTimeout);
                        initApp();
                    }
                }, 100);
            }
        });
    </script>
</body>
</html>